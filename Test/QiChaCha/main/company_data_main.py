# -*-coding:utf-8-*-
import sys
import os

sys.path.append(os.path.dirname(__file__) + os.sep + "../../../")

from Log import log
from Utils import redispool_utils
from Utils import mysqlpool_utils
from Utils import create_ua_utils
from Test.QiChaCha.dao import dao
from Test.QiChaCha.middleware import download_middleware

log_file_dir = 'QiChaCha'  # LOG日志存放路径
LOGNAME = '<企查查数据抓取_非登录>'  # LOG名
LOGGING = log.ILog(log_file_dir, LOGNAME)

class SpiderMain(object):
    def __init__(self, cookie, user_agent):
        self.dao = dao.Dao()
        self.download = download_middleware.Download(cookies=cookie, user_agent=user_agent)

    def handle(self, redis_client, obj):
        # 获取任务响应
        resp = self.download.getResp(logging=LOGGING, redis_client=redis_client, url=obj)
        print(resp)

    def run(self):
        redis_client = redispool_utils.createRedisPool()
        mysql_client = mysqlpool_utils.createMysqlPool()
        # 获取100个任务
        # object_list = self.dao.getObjectForRedis(logging=LOGGING, redis_client=redis_client, count=100)
        obj_list = ['https://www.qichacha.com/firm_6bc7e7ccdb755391651316a0227c059b.html', 'https://www.qichacha.com/firm_0f55a874365a7f7e7d04d32ab84a3610.html', 'https://www.qichacha.com/firm_c9f2ddb240f847d210a70164cc0d7f12.html', 'https://www.qichacha.com/firm_0f510003546ae146ed1a95d28bdee99e.html', 'https://www.qichacha.com/firm_14fc156b520404295d7d2372509a3f0d.html', 'https://www.qichacha.com/firm_66672ebcef4d3df68aa1cfb9cf062982.html', 'https://www.qichacha.com/firm_14f23dccee8569402aedc457d5d6b605.html', 'https://www.qichacha.com/firm_d8c56557b42bc9e57c3c7973cd47b450.html', 'https://www.qichacha.com/firm_bd1fe6299ad6928bac1b9dd263e9e7a0.html', 'https://www.qichacha.com/firm_857b72c93944dcfcf853a2c5224aeab3.html', 'https://www.qichacha.com/firm_b087d59e9e5e8e44638fecfa196cd43d.html', 'https://www.qichacha.com/firm_93d11862a6496e28810a38cb2a50f4d1.html', 'https://www.qichacha.com/firm_c38a281bfab64f9f2316484a46f73b47.html', 'https://www.qichacha.com/firm_60207963e76f39d6671fad5afbd05cb3.html', 'https://www.qichacha.com/firm_200a44e92eb754e7c5856019e81f98c4.html', 'https://www.qichacha.com/firm_30d5dea41e410cb19dc540ed57bcb1bc.html', 'https://www.qichacha.com/firm_b3952b9b56233acd12aaf367682c0bd3.html', 'https://www.qichacha.com/firm_501cfb4cdfc6bbccc3953201e24adfca.html', 'https://www.qichacha.com/firm_5f70703f4425ad15588c831ba080b57e.html', 'https://www.qichacha.com/firm_b9efc740389d8da8e190e7fdf6243271.html', 'https://www.qichacha.com/firm_6666135cca7313616ebc9111e7b0113d.html', 'https://www.qichacha.com/firm_c9f28147438b28f57ec16e24fb4f6424.html', 'https://www.qichacha.com/firm_d5799f19a24f7004bb49a6998a612f11.html', 'https://www.qichacha.com/firm_30c159a8b153b0deec08026b8f3b19af.html', 'https://www.qichacha.com/firm_a55d3c2819d874dbf8451d60ef3815c4.html', 'https://www.qichacha.com/firm_03e8094931bfe33c19c6c70d38d2b028.html', 'https://www.qichacha.com/firm_6016e724acb597125860cbaf1ef853dc.html', 'https://www.qichacha.com/firm_60044f72ce0195f6902cae2c2f51f4be.html', 'https://www.qichacha.com/firm_c07aad05a93e3151953c2890f7daf7e0.html', 'https://www.qichacha.com/firm_93d78c09dbe64aa6438481686f69cd3f.html', 'https://www.qichacha.com/firm_9a2c1ea4fe60a8273d3f28f15d8edb21.html', 'https://www.qichacha.com/firm_cd357bc1311dad01ceb70f594e9a0ccc.html', 'https://www.qichacha.com/firm_4777b34d55ab5533fbf12b1f0f3768a5.html', 'https://www.qichacha.com/firm_e50a225a8570e555b9e4c9333d47ef09.html', 'https://www.qichacha.com/firm_1dc8001dcfe21e060a50f074552330d2.html', 'https://www.qichacha.com/firm_60b7274cdfdbfdc03f350c7b754adb34.html', 'https://www.qichacha.com/firm_c38bed518efc278bcd0c86e946ccd9f7.html', 'https://www.qichacha.com/firm_001d0658e1736259ac10fca2189b0f55.html', 'https://www.qichacha.com/firm_201a1911d4084f5e400da1b017b94e81.html', 'https://www.qichacha.com/firm_001088bf9e2f8b55749823c5c0ab4078.html', 'https://www.qichacha.com/firm_504dee82b76c2652670df4b40dbae9d6.html', 'https://www.qichacha.com/firm_dbced55f971ff26f8da166bf4e088b6a.html', 'https://www.qichacha.com/firm_dbd3944094884b02b57a9c38382ff060.html', 'https://www.qichacha.com/firm_5f7a30b58d9860c6116356d42478e338.html', 'https://www.qichacha.com/firm_eb4ad43ae2dc4ca5824cd0e81ac698f5.html', 'https://www.qichacha.com/firm_90bdf3f1ab2fbbf681b7c50c63fd161a.html', 'https://www.qichacha.com/firm_e501fa159ba9b85367e53acdde844afc.html', 'https://www.qichacha.com/firm_6008051386d5ee922c033974b3a106b1.html', 'https://www.qichacha.com/firm_a63331cc763a8b4fdfc79224acae55d8.html', 'https://www.qichacha.com/firm_88690baa897d5c60128787f74db4731a.html', 'https://www.qichacha.com/firm_90bc57e4e792c2bf339e36554def3b14.html', 'https://www.qichacha.com/firm_78430ec6c53ae4666986b543f75b9290.html', 'https://www.qichacha.com/firm_d8ca7005e60cd3803253b0b43a265bc8.html', 'https://www.qichacha.com/firm_eb588a65f919b00bd85c2c22cfdc5e11.html', 'https://www.qichacha.com/firm_fa7ad6d0c34d41120a211be53c57fd4d.html', 'https://www.qichacha.com/firm_502d43b870a9dad0bb70e37b7ee4e945.html', 'https://www.qichacha.com/firm_50b559c01c279142e66ce086335dfa3c.html', 'https://www.qichacha.com/firm_b39e15520b80f023544d28d745319a38.html', 'https://www.qichacha.com/firm_2409439372783e05fc848155e75da6ed.html', 'https://www.qichacha.com/firm_fa72324c7dbfe4f3f3575922b1462417.html', 'https://www.qichacha.com/firm_b9dfe9419a98a29d99d465c1ddb5c20a.html', 'https://www.qichacha.com/firm_30c2dfbef739ed6439dfd0a1f531d45e.html', 'https://www.qichacha.com/firm_56b82638f9204da0dfb4fe446729bf27.html', 'https://www.qichacha.com/firm_17d10da2b2165c4a3ac0098b4366848b.html', 'https://www.qichacha.com/firm_2fd6e6a89b08b5f5010c63b75d52000c.html', 'https://www.qichacha.com/firm_60ab1a1e1f6b24fe7ae08caa86e0c297.html', 'https://www.qichacha.com/firm_7e241749d3e175dbf196be4bbf1bd7ca.html', 'https://www.qichacha.com/firm_50735edb581d1a84c24ce32f7e4b4948.html', 'https://www.qichacha.com/firm_2fee09342ace73603a5c78ddc83d980d.html', 'https://www.qichacha.com/firm_a9481163d3fe2177412eeb441410cf03.html', 'https://www.qichacha.com/firm_acd44953ce8ff97356325dce04863f39.html', 'https://www.qichacha.com/firm_2fe1bf11cdfe0a73ddca0e69f680b262.html', 'https://www.qichacha.com/firm_60085c9c484e4281743aa0f49bdc6c56.html', 'https://www.qichacha.com/firm_597fa8c958722c3790b39c54b1e0aa18.html', 'https://www.qichacha.com/firm_6005dfbee0587fd25cb1e4d1d2b12d4f.html', 'https://www.qichacha.com/firm_44b14fba0cfaa4d7bfac9bb3e1c15f50.html', 'https://www.qichacha.com/firm_3784f0951351f3d9b83bbe5c56fb1636.html', 'https://www.qichacha.com/firm_30c0190a28692c7d8cf49711ec41351d.html', 'https://www.qichacha.com/firm_37803d8b5b0da603fb17cb7615eb4034.html', 'https://www.qichacha.com/firm_b38d62a92afda520906481da6b0e4a2f.html', 'https://www.qichacha.com/firm_50979c3141b756e85e0cc13a2e2d90cd.html', 'https://www.qichacha.com/firm_df0791fc30b26cb974432049df038161.html', 'https://www.qichacha.com/firm_9716d9d3e476610effd6ac1533e02e95.html', 'https://www.qichacha.com/firm_26d333a3d9055d36f0fd3ad699c1a84a.html', 'https://www.qichacha.com/firm_2cedcf53ce5658225d78810ceb20822b.html', 'https://www.qichacha.com/firm_504bf109d648540c3e553278abd4f876.html', 'https://www.qichacha.com/firm_3d94abca95b9891b67562ababa2af558.html', 'https://www.qichacha.com/firm_b07bc9cc36a41ea603204496c6aa2954.html', 'https://www.qichacha.com/firm_eb5e978788ac48bf5e0dbd1cc4e36b31.html', 'https://www.qichacha.com/firm_b39325ea9fd5c9bcfcacbb485fe9f525.html', 'https://www.qichacha.com/firm_507d79df5452b6a905e0b2ca44cb866d.html', 'https://www.qichacha.com/firm_8867eb9464f92ac4df1dc7fdb29f8fa8.html', 'https://www.qichacha.com/firm_6f0aaf12a0389c8574cf30a6d103af85.html', 'https://www.qichacha.com/firm_c9fea29b636335114ccc5dbb93df9c57.html', 'https://www.qichacha.com/firm_f41a3a37edb90c92cd12872e1f690c56.html', 'https://www.qichacha.com/firm_93cca8514fa9af6613ab598c5f80afd5.html', 'https://www.qichacha.com/firm_40b2d7ee91a39ef99b60975ea8836158.html', 'https://www.qichacha.com/firm_93be8df22e611d53ac64be600eeb6b12.html', 'https://www.qichacha.com/firm_5040e95c6b48f5a16fcd25434ec6a582.html', 'https://www.qichacha.com/firm_717f989cbaf58219d60b5c19f5075f85.html']
        for obj in obj_list:
            self.handle(redis_client=redis_client, obj=obj)
            break


if __name__ == '__main__':
    cookie = 'null'
    user_agent = create_ua_utils.get_ua()
    main_obj = SpiderMain(cookie=cookie, user_agent=user_agent)
    main_obj.run()